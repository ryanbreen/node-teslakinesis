

  <div class="page-header">
    <h1>
     Trips
     <small><i class="ace-icon fa fa-angle-double-right"></i> most recent trips appear at the top</small>
   </h1>
  </div>

  <div class="row"><div class="col-xs-12">
 
  <% @trips.each_with_index do |trip, index| %>

    <div id="timeline-<%= index %>">

      <div class="row"><div class="col-xs-12 col-sm-10 col-sm-offset-1">

        <div class="timeline-container">
          <div class="timeline-label">
             <span class="label label-primary arrowed-in-right label-lg">
               <b><%= @trip_detail[index]['pretty_start_date'] %></b>
             </span>
          </div>
          <div class="timeline-items">

            <!-- Populate Destination, if any -->
            <div class="timeline-item clearfix">
               <div class="timeline-info">
                 <i class="timeline-indicator ace-icon fa fa-<%= trip.end_time == nil ? 'play-circle' : 'stop' %> btn btn-danger no-hover"></i>
               </div>

               <div class="widget-box transparent">
                 <div class="widget-header widget-header-small">
                  <% if trip.end_time == nil %>
                  <h5 class="widget-title smaller">Trip ongoing</h5>
                    <% trip.end_time = Time.now %>
                  <% elsif trip.destination == nil %>
                  <h5 class="widget-title smaller">Arrived at an unknown location (<%=
                        link_to 'name it!', new_vehicle_location_path(:vehicle_id => params[:vehicle_id], 
                          :lng => trip[:end_location].longitude, :lat => trip[:end_location].latitude, 
                          :z => trip[:end_location].z) %>)
                          </h5>
                  <% else %>
                  <h5 class="widget-title smaller">Arrived at <%= link_to trip.destination.name, vehicle_location_path(trip.vehicle_id, trip.destination) %></h5>
                  <% end %>
                  <span class="widget-toolbar no-border">
                    <span class="label label-warning"><%= @trip_detail[index]['pretty_duration'] %></span>
                    <i class="ace-icon fa fa-clock-o bigger-110"></i>
                    <%= trip.end_time.in_time_zone('America/New_York').to_formatted_s(:time_us) %>
                  </span>
                  <span class="widget-toolbar">
                    <a href="#" data-action="collapse"><i class="ace-icon fa fa-chevron-up"></i></a>
                  </span>
                </div>
                <div class="widget-body"><div class="widget-main">
                  <a href="<%= vehicle_trip_path(trip.vehicle_id, trip.id) %>">
                  <%= render 'trip', :index => index, :width => 400, :height => 200, :trip => trip, :trip_detail => @trip_detail[index] %>
                  </a>
                </div></div>
              </div>
            </div>

            <% if trip.badges.length > 0 %>

              <div class="timeline-item clearfix">
                 <div class="timeline-info">
                   <i class="timeline-indicator ace-icon fa fa-certificate btn btn-warning no-hover"></i>
                 </div>

                 <div class="widget-box transparent">
                   <div class="widget-header widget-header-small">
                    <h5 class="widget-title smaller">Badges Earned!</h5>
                    <span class="widget-toolbar">
                      <a href="#" data-action="collapse"><i class="ace-icon fa fa-chevron-up"></i></a>
                    </span>
                  </div>
                  <div class="widget-body"><div class="widget-main">
                    <% trip.badges.each_with_index do |badge, i| %>
                      <span class='ace-icon fa fa-<%= badge.custom_fields[:icon] %> btn btn-<%= badge.custom_fields[:type] %> btn-default badge-<%=trip.id%>-<%=index%> no-hover' title="<%= badge.description %>" ></span>
                      <script>
                        $('.badge-<%=trip.id%>-<%=index%>').tooltip();
                      </script>
                    <% end %>
                  </div></div>
                </div>
              </div>

            <% end %> <!-- if badges -->

            <!-- Populate Origin, if any -->
            <div class="timeline-item clearfix">
               <div class="timeline-info">
                 <i class="timeline-indicator ace-icon fa fa-play btn btn-success no-hover"></i>
               </div>

               <div class="widget-box transparent">
                 <div class="widget-body"><div class="widget-main">
                  <% if trip.origin == nil %>
                  Departed from an unknown location (<%=
                          link_to 'name it!', new_vehicle_location_path(:vehicle_id => params[:vehicle_id], 
                          :lng => trip[:start_location].longitude, :lat => trip[:start_location].latitude, 
                          :z => trip[:start_location].z) %>)</h5>
                  <% else %>
                  Departed <%= link_to trip.origin.name, vehicle_location_path(trip.vehicle_id, trip.origin) %>
                  <% end %>
                  <div class="pull-right">
                    <i class="ace-icon fa fa-clock-o bigger-110"></i>
                    <%= trip.start_time.in_time_zone('America/New_York').to_formatted_s(:time_us) %>
                  </div>
                </div></div>
              </div>
            </div>

          </div>
        </div>
        <div class="space-6"></div>
      </div></div>
    </div>
<% end %>

<div class="trip_pagination">
<%= will_paginate @trips, :container => false %>
</div>

</div></div>
